
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>NEMS PHP Server Agent &#8212; NEMS Linux Documentation 1.6 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="nems-api" href="nems-api.html" />
    <link rel="prev" title="Copying OS Icons to NEMS" href="nemsicons.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="nems-php-server-agent">
<h1>NEMS PHP Server Agent<a class="headerlink" href="#nems-php-server-agent" title="Permalink to this headline">¶</a></h1>
<p>Monitor your Linux-based PHP-enabled web server with the NEMS PHP Server Agent.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>A Linux-based public web server with PHP 5.2+.</p>
<p>I have tested successfully on Debian 10 with PHP 7.3 as well as Debian 7 with PHP 5.2. I have not tested on any non-Debian system, so if you do, please let me know if it works or not and I will add it here.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="obtaining-your-php-agent">
<h3>Obtaining your PHP Agent<a class="headerlink" href="#obtaining-your-php-agent" title="Permalink to this headline">¶</a></h3>
<p>In NEMS SST, download your custom nems-agent.php file. Upload this file to your web server and add the NEMS PHP Agent check command in NEMS NConf.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You’ll notice in the check commands below, the actual script filename is entered. This is intentional, and allows you to add obscurity if desired by naming your NEMS PHP Server Agent anything you like (as long as it has a .php extension).</p>
</div>
</div>
</div>
<div class="section" id="check-command">
<h2>Check Command<a class="headerlink" href="#check-command" title="Permalink to this headline">¶</a></h2>
<p><em>check_nems_php_agent</em> is part of NEMS Linux 1.6.</p>
</div>
<div class="section" id="why-use-the-nems-php-server-agent">
<h2>Why Use the NEMS PHP Server Agent<a class="headerlink" href="#why-use-the-nems-php-server-agent" title="Permalink to this headline">¶</a></h2>
<p>The NEMS PHP Server Agent is designed specifically to collect system data from a PHP server. Disk space and usage, memory size and usage, system load, etc. Unlike NRPE, the agent reports very specific data rather than running remote commands on your server. This makes it easier to use on a public server where firewall rules might be too complex for novice sysadmins to make NRPE a safe option. The NEMS PHP Server Agent is designed to be safe out of the box, and incredibly easy to deploy: Just upload it to a public folder on your web server and point your check commands on your NEMS Server to the URL.</p>
<div class="section" id="check-command-arguments">
<h3>Check Command Arguments<a class="headerlink" href="#check-command-arguments" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>URL</strong>&nbsp;- The URL to your <em>nems-agent.php</em> on the remote server.</li>
<li><strong>Check</strong>&nbsp;- Percent Memory Usage [mem], Percent Disk Usage (Running Folder) [.], Percent Disk Usage (/) [disk], Percent Disk Usage (/var) [var], Network Usage Mb/s [net], Network Usage Mb/s Download Only [netrx], Network Usage Mb/s Upload Only [nettx], 15 Minute System Load Average [load].</li>
<li><strong>Warn Up / Warn Down / Critical Up / Critical Down</strong>&nbsp;- Set your
thresholds. Can be a positive floating point number or integer.</li>
</ul>
</div>
<div class="section" id="cli-examples">
<h3>CLI Examples<a class="headerlink" href="#cli-examples" title="Permalink to this headline">¶</a></h3>
<p>WARN if 15 minute system load average exceeds 3, CRIT if over 9:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">./check_nems_php_agent 3 9 https://example.com/nems-agent.php load</span>
</pre></div>
</div>
<p>WARN if / disk usage is over 80%, CRIT if over 90%.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">./check_nems_php_agent 80 90 https://example.com/nems-agent.php disk</span>
</pre></div>
</div>
<p>WARN if either up or down network usage exceed 1 Mb/s, CRIT if over 2 Mb/s:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">./check_nems_php_agent 1 2 https://example.com/nems-agent.php net</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-security">
<h2>Data Security<a class="headerlink" href="#data-security" title="Permalink to this headline">¶</a></h2>
<p>All data is encrypted server-side using AES-128-ECB using an encryption/decryption key you provide in NEMS System Settings Tool.</p>
</div>
<div class="section" id="under-the-hood">
<h2>Under The Hood<a class="headerlink" href="#under-the-hood" title="Permalink to this headline">¶</a></h2>
<p>The agent outputs the following JSON string (Sample data):</p>
<div class="highlight-JSON"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;ver&quot;</span><span class="p">:{</span><span class="nt">&quot;nems&quot;</span><span class="p">:</span><span class="s2">&quot;1.6&quot;</span><span class="p">,</span><span class="nt">&quot;nemsagent&quot;</span><span class="p">:</span><span class="s2">&quot;1.1&quot;</span><span class="p">},</span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="s2">&quot;pICGwq5UL3O8yNEYdPrQh\/8PGCjsXQUx9mh9VIQloFJ\/K8BsB5AT9L2ixwlsiDAJGjWR1RnhsrCFHVnKD9p3cmRxhQf\/knW6F+EkDS3CnkrlXWLSPJ6p+gfZjIq16NSREvfaaPJZEY93mBrgSFArs+C8advgKL+0jz2a55ItGk0BY6AKvOMuFXfxzwd3i7485tusJaP9X8K9dL5msEvHfPLKdORyTUm7iNt6ssFARMzg4oXoVnebT4okZ6eyG3tjQIBPOFebmNAO78agymi6UEm44u\/wfPmUtkEtU841FVmcfGLxcEIoogzG9vjH8q7urs2RetcBVpVhj5Z+T+v8qa9oQ7Pi1tbf2\/IhF+eLE9cSkmMlmbFbJ70hJqaY2gssiwb9tZ6g0dX+WA8+ujTzmCzBdNJ09HabaLVzXTqR4cGyFM3mXYQl+SdDSdmeZ\/vw\/sG4oSFxxKzhxmOpCM5qBw==&quot;</span><span class="p">,</span><span class="nt">&quot;auth&quot;</span><span class="p">:</span><span class="s2">&quot;312433c28349f63c4f387953ff337046e794bea0f9b9ebfcb08e90046ded9c76&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>That is what a user would see if they were to open the agent in their browser, and is what is downloaded to your NEMS Server when the check commands run.</p>
<p>Your NEMS Server knows your decryption key used by the agent to encrypt the data. When decrypted by your NEMS Server, the data looks like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">Array</span>
<span class="x">   (</span>
<span class="x">     [ver] =&gt; Array</span>
<span class="x">         (</span>
<span class="x">             [nems] =&gt; 1.6</span>
<span class="x">             [nemsagent] =&gt; 1.1</span>
<span class="x">         )</span>
<span class="x">     [data] =&gt; Array</span>
<span class="x">         (</span>
<span class="x">             [cpu] =&gt; Array</span>
<span class="x">                 (</span>
<span class="x">                     [usage] =&gt; 0</span>
<span class="x">                     [model] =&gt; Intel(R) Xeon(R) CPU E5-2676 v3 @ 2.40GHz</span>
<span class="x">                     [loadaverage] =&gt; Array</span>
<span class="x">                         (</span>
<span class="x">                             [1] =&gt; 0</span>
<span class="x">                             [5] =&gt; 0</span>
<span class="x">                             [15] =&gt; 0</span>
<span class="x">                         )</span>
<span class="x">                 )</span>
<span class="x">             [mem] =&gt; Array</span>
<span class="x">                 (</span>
<span class="x">                     [percent] =&gt; 23.5</span>
<span class="x">                     [total] =&gt; 0.472</span>
<span class="x">                     [free] =&gt; 0.032</span>
<span class="x">                     [used] =&gt; 0.44</span>
<span class="x">                 )</span>
<span class="x">             [storage] =&gt; Array</span>
<span class="x">                 (</span>
<span class="x">                     [.] =&gt; Array</span>
<span class="x">                         (</span>
<span class="x">                             [path] =&gt; /var/www/html</span>
<span class="x">                             [free] =&gt; 6.11</span>
<span class="x">                             [total] =&gt; 7.69</span>
<span class="x">                             [used] =&gt; 1.58</span>
<span class="x">                             [percent] =&gt; 0</span>
<span class="x">                         )</span>
<span class="x">                     [/] =&gt; Array</span>
<span class="x">                         (</span>
<span class="x">                             [free] =&gt; 6.11</span>
<span class="x">                             [total] =&gt; 7.69</span>
<span class="x">                             [used] =&gt; 1.58</span>
<span class="x">                             [percent] =&gt; 0</span>
<span class="x">                         )</span>
<span class="x">                     [/var] =&gt; Array</span>
<span class="x">                         (</span>
<span class="x">                             [free] =&gt; 6.11</span>
<span class="x">                             [total] =&gt; 7.69</span>
<span class="x">                             [used] =&gt; 1.58</span>
<span class="x">                             [percent] =&gt; 0</span>
<span class="x">                         )</span>
<span class="x">                 )</span>
<span class="x">             [network] =&gt; Array</span>
<span class="x">                 (</span>
<span class="x">                     [rx] =&gt; 0.01</span>
<span class="x">                     [tx] =&gt; 0.01</span>
<span class="x">                 )</span>
<span class="x">         )</span>
<span class="x">     [auth] =&gt; 312433c28349f63c4f387953ff337046e794bea0f9b9ebfcb08e90046ded9c76</span>
<span class="x">   )</span>
</pre></div>
</div>
<p>The “auth” hash is a cryptographically-safe hash of your encrypted passphrase, and is what your NEMS Server uses to ensure the NEMS Server passphrase matches that of your NEMS PHP Server Agent. In this way, a third party cannot find a nems-agent.php running on your server and access your data from their NEMS Server. They will receive an error that the auth key does not match. Similarily, it means you can deploy your NEMS PHP Server Agent on as many PHP servers as you like, and even use multiple NEMS Servers to monitor it (as long as you key in the same passphrase on each NEMS Server).</p>
<p>This data output above is used by your NEMS Server’s <em>check_nems_php_agent</em> check commands.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">NEMS PHP Server Agent</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#obtaining-your-php-agent">Obtaining your PHP Agent</a></li>
</ul>
</li>
<li><a class="reference internal" href="#check-command">Check Command</a></li>
<li><a class="reference internal" href="#why-use-the-nems-php-server-agent">Why Use the NEMS PHP Server Agent</a><ul>
<li><a class="reference internal" href="#check-command-arguments">Check Command Arguments</a></li>
<li><a class="reference internal" href="#cli-examples">CLI Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-security">Data Security</a></li>
<li><a class="reference internal" href="#under-the-hood">Under The Hood</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="nemsicons.html" title="previous chapter">Copying OS Icons to NEMS</a></li>
      <li>Next: <a href="nems-api.html" title="next chapter">nems-api</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/advanced/nems_php_agent.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Category5 TV Network.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../_sources/advanced/nems_php_agent.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>