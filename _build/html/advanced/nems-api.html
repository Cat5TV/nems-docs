
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>nems-api &#8212; NEMS Linux Documentation 1.6 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NEMS Accessories" href="../accessories/index.html" />
    <link rel="prev" title="NEMS PHP Server Agent" href="nems_php_agent.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="nems-api">
<h1>nems-api<a class="headerlink" href="#nems-api" title="Permalink to this headline">¶</a></h1>
<p><em>nems-api</em> is a web-based api interface that outputs json data related
to your NEMS server. It is lightweight, fast, and offers a connection
for both internal NEMS features and third-party devices.</p>
<p><em>nems-api</em> will always return either <em>success: true</em> or <em>success: false</em>
to tell you whether a query was successful or not.</p>
<div class="section" id="ip-restrictions">
<h2>IP Restrictions<a class="headerlink" href="#ip-restrictions" title="Permalink to this headline">¶</a></h2>
<p>By default, access to <em>nems-api</em> is limited to the following IP
addresses:</p>
<ul class="simple">
<li>127.0.0.1</li>
<li>10.0.0.0 - 10.255.255.255</li>
<li>172.16.0.0 - 172.31.255.255</li>
<li>192.168.0.0 - 192.168.255.255</li>
</ul>
<p>If you need to add an outside IP address, please put in a feature
request in the Community Forum to add this feature to NEMS-SST. If there
is demand for it, it will be added.</p>
</div>
<div class="section" id="secure-certificate">
<h2>Secure Certificate<a class="headerlink" href="#secure-certificate" title="Permalink to this headline">¶</a></h2>
<p>NEMS Linux uses self-signed certificates. In order to pull <em>nems-api</em>
data over ssl (ie., https), you must ignore the certificates via your
application.</p>
</div>
<div class="section" id="command-examples">
<h2>Command Examples<a class="headerlink" href="#command-examples" title="Permalink to this headline">¶</a></h2>
<p>All examples in this document assume that the API is available at</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">nems</span><span class="o">.</span><span class="n">local</span><span class="o">/</span><span class="n">nems</span><span class="o">-</span><span class="n">api</span><span class="o">/</span>
</pre></div>
</div>
<ul class="simple">
<li><a class="reference external" href="http://nems.local/nems-api/hosts">http://nems.local/nems-api/hosts</a> - output all configured hosts</li>
<li><a class="reference external" href="http://nems.local/nems-api/services">http://nems.local/nems-api/services</a> - output all configured services</li>
<li><a class="reference external" href="http://nems.local/nems-api/downtimes">http://nems.local/nems-api/downtimes</a> - output all scheduled downtimes</li>
<li><a class="reference external" href="http://nems.local/nems-api/hosts?Columns=name,state">http://nems.local/nems-api/hosts?Columns=name,state</a> - output all host
names along with their current state</li>
</ul>
<div class="section" id="response-format">
<h3>Response Format<a class="headerlink" href="#response-format" title="Permalink to this headline">¶</a></h3>
<p>All responses are in JSON and have the following format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">bool</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">object</span><span class="o">&gt;</span><span class="p">}</span>
</pre></div>
</div>
<p>If “success” is true, “content” will contain the requested data. If
false, it will contain</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">}</span>
</pre></div>
</div>
<p>where “code” is the mk-livestatus error code and “message” is a
human-readable explanation of the error.</p>
</div>
<div class="section" id="query-interface">
<h3>Query interface<a class="headerlink" href="#query-interface" title="Permalink to this headline">¶</a></h3>
<p>The query interface returns a list of objects in JSON. The available
endpoints are the same as the tables available from mk-livestatus
itself:</p>
<ul class="simple">
<li>hosts</li>
<li>services - Nagios services, joined with all data from hosts</li>
<li>hostgroups</li>
<li>servicegroups</li>
<li>contactgroups</li>
<li>servicesbygroup - all services grouped by service groups</li>
<li>servicesbyhostgroup - all services grouped by host groups</li>
<li>hostsbygroup - all hosts grouped by host groups</li>
<li>contacts</li>
<li>commands - your defined Nagios commands</li>
<li>timeperiods - time period definitions (currently only name and alias)</li>
<li>downtimes - all scheduled host and service downtimes, joined with
data from hosts and services.</li>
<li>comments - all host and service comments</li>
<li>log - a transparent access to the nagios logfiles</li>
<li>status - general performance and status information. This table
contains exactly one dataset.</li>
<li>columns - a complete list of all tables and columns available via
Livestatus, including descriptions!</li>
<li>statehist - sla statistics for hosts and services, joined with data
from hosts, services and log.</li>
</ul>
<p>To retrieve all records from a table, send a GET request to</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">nems</span><span class="o">.</span><span class="n">local</span><span class="o">/</span><span class="n">nems</span><span class="o">-</span><span class="n">api</span><span class="o">/</span><span class="p">{</span><span class="n">tablename</span><span class="p">}</span>
</pre></div>
</div>
<p>For example, to get all host records from the server, GET</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">nems</span><span class="o">.</span><span class="n">local</span><span class="o">/</span><span class="n">nems</span><span class="o">-</span><span class="n">api</span><span class="o">/</span><span class="n">hosts</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="columns">
<h2>Columns<a class="headerlink" href="#columns" title="Permalink to this headline">¶</a></h2>
<p>To limit the returned data to a subset of the available fields, pass a
Columns query parameter containing a comma-separated list of column
names. To fetch the name and services list for all hosts:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://nems.local/nems-api/hosts?Columns=name,services
</pre></div>
</div>
</div>
<div class="section" id="filters">
<h2>Filters<a class="headerlink" href="#filters" title="Permalink to this headline">¶</a></h2>
<p>To filter the result set to records meeting some criteria, pass one or
more Filter[] params. Each Filter is a urlencoded LQL filter (see the
[mk-livestatus
documentation](<a class="reference external" href="http://mathias-kettner.com/checkmk_livestatus.html#H1:LQL">http://mathias-kettner.com/checkmk_livestatus.html#H1:LQL</a>
- The Livestatus Query Language) for detailed LQL filter syntax). If
more than one filter is specified, they are ANDed together. To get all
hosts starting with “api” in state OK (0):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://nems.local/nems-api/hosts?Filter[]=name ~ ^api&amp;Filter[]=state = 0
</pre></div>
</div>
</div>
<div class="section" id="stats">
<h2>Stats<a class="headerlink" href="#stats" title="Permalink to this headline">¶</a></h2>
<p>Stats queries allow you to get a count of objects matching a criteria.
Stats queries return a list of counts and never take a Columns
parameter. You can request several Stats with a single API call. You can
also restrict the objects counted by adding Filters to your query. To
count the number of hosts starting with “api” in state OK:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://nems.local/nems-api/hosts?&amp;Stats[]=name ~ ^api&amp;Filter[]=state = 0
</pre></div>
</div>
<div class="section" id="command-interface">
<h3>Command Interface<a class="headerlink" href="#command-interface" title="Permalink to this headline">¶</a></h3>
<p>All calls to <code class="docutils literal"><span class="pre">nems-api</span></code> to execute Nagios commands <strong>must be HTTP POST
requests</strong>.</p>
</div>
</div>
<div class="section" id="acknowledgements">
<h2>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>Acknowledgements for host and service alerts can be sent via the
<code class="docutils literal"><span class="pre">acknowledge_problem</span></code> endpoint.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="ow">is</span> <span class="o">-</span><span class="n">XPOST</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">nems</span><span class="o">.</span><span class="n">local</span><span class="o">/</span><span class="n">nems</span><span class="o">-</span><span class="n">api</span><span class="o">/</span><span class="n">acknowledge_problem</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;host&quot;: &quot;host.example.com&quot;, &quot;author&quot;: &quot;rfrantz&quot;, &quot;comment&quot;: &quot;acked from livestatus&quot;}&#39;</span>
</pre></div>
</div>
<p>Acknowledging service alerts is similar to host alerts, with the
addition of the <code class="docutils literal"><span class="pre">service</span></code> parameter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="ow">is</span> <span class="o">-</span><span class="n">XPOST</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">nems</span><span class="o">.</span><span class="n">local</span><span class="o">/</span><span class="n">nems</span><span class="o">-</span><span class="n">api</span><span class="o">/</span><span class="n">acknowledge_problem</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;host&quot;: &quot;host.example.com&quot;, &quot;service&quot;: &quot;Apache&quot;, &quot;author&quot;: &quot;rfrantz&quot;, &quot;comment&quot;: &quot;acked from livestatus&quot;}&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="downtime">
<h2>Downtime<a class="headerlink" href="#downtime" title="Permalink to this headline">¶</a></h2>
<p>Existing scheduled downtimes for a host can be canceled.
<code class="docutils literal"><span class="pre">cancel_downtime</span></code> expects the <code class="docutils literal"><span class="pre">downtime_id</span></code> parameter. Downtime IDs
can be found by querying a host and extracting the <code class="docutils literal"><span class="pre">downtimes</span></code> array:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>curl -s https://nems.local/nems-api/hosts?Filter=name = my_host | jq &#39;.&#39; | grep &#39;downtimes&quot;&#39; -A 2

&quot;downtimes&quot;: [
    12345
],
</pre></div>
</div>
<p>The subsequent request to cancel the host’s downtime is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">XPOST</span> <span class="s1">&#39;https://nems.local/nems-api/cancel_downtime&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;downtime_id&quot;: &quot;12345&quot;}&#39;</span>
</pre></div>
</div>
<p>To cancel the downtime for a service, pass the name of the service along
with the downtime_id:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">XPOST</span> <span class="s1">&#39;https://nems.local/nems-api/cancel_downtime&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;downtime_id&quot;: &quot;12345&quot;, &quot;service&quot;: &quot;CPU&quot;}&#39;</span>
</pre></div>
</div>
<p>Schedule downtime for a host as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">XPOST</span> <span class="s1">&#39;https://nems.local/nems-api/schedule_downtime&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;host&quot;: &quot;host.example.com&quot;, &quot;duration&quot;: &quot;7200&quot;, &quot;author&quot;: &quot;rfrantz&quot;, &quot;comment&quot;: &quot;Downtimed via livestatus&quot;}&#39;</span>
</pre></div>
</div>
<p><strong>NOTE</strong>: The <code class="docutils literal"><span class="pre">duration</span></code> field expects a value whose unit is in
seconds.</p>
<p>Downtimes can be scheduled for a particular service by adding a
<code class="docutils literal"><span class="pre">&quot;service&quot;</span></code> parameter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">XPOST</span> <span class="s1">&#39;https://nems.local/nems-api/schedule_downtime&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;host&quot;: &quot;host.example.com&quot;, &quot;service&quot;: &quot;CPU&quot;, duration&quot;: &quot;7200&quot;, &quot;author&quot;: &quot;rfrantz&quot;, &quot;comment&quot;: &quot;Downtimed via livestatus&quot;}&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="notifications">
<h2>Notifications<a class="headerlink" href="#notifications" title="Permalink to this headline">¶</a></h2>
<p>Notifications for a host, a host’s service, or all of the host’s
services can be disabled via the <code class="docutils literal"><span class="pre">disable_notifications</span></code> endpoint.</p>
<p>Send a request that includes a valid ‘host’ value:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">XPOST</span> <span class="s1">&#39;https://nems.local/nems-api/disable_notifications&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;host&quot;: &quot;host.example.com&quot;}&#39;</span>
</pre></div>
</div>
<p>Send a request that includes valid ‘host’ and ‘service’ values:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">XPOST</span> <span class="s1">&#39;https://nems.local/nems-api/disable_notifications&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;host&quot;: &quot;host.example.com&quot;, &quot;service&quot;: &quot;httpd&quot;}&#39;</span>
</pre></div>
</div>
<p>Send a request that includes a valid ‘host’ value and set ‘scope’ to
‘all’:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">XPOST</span> <span class="s1">&#39;https://nems.local/nems-api/disable_notifications&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;host&quot;: &quot;host.example.com&quot;, &quot;scope&quot;: &quot;all&quot;}&#39;</span>
</pre></div>
</div>
<p>Notifications for a host, a host’s service, or all of the host’s
services can be enabled via the <code class="docutils literal"><span class="pre">enable_notifications</span></code> endpoint.</p>
<p>Send a request that includes a valid ‘host’ value:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">XPOST</span> <span class="s1">&#39;https://nems.local/nems-api/enable_notifications&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;host&quot;: &quot;host.example.com&quot;}&#39;</span>
</pre></div>
</div>
<p>Send a request that includes valid ‘host’ and ‘service’ values:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">XPOST</span> <span class="s1">&#39;https://nems.local/nems-api/enable_notifications&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;host&quot;: &quot;host.example.com&quot;, &quot;service&quot;: &quot;httpd&quot;}&#39;</span>
</pre></div>
</div>
<p>Send a request that includes a valid ‘host’ value and set ‘scope’ to
‘all’:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">XPOST</span> <span class="s1">&#39;https://nems.local/nems-api/enable_notifications&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;host&quot;: &quot;host.example.com&quot;, &quot;scope&quot;: &quot;all&quot;}&#39;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">nems-api</a><ul>
<li><a class="reference internal" href="#ip-restrictions">IP Restrictions</a></li>
<li><a class="reference internal" href="#secure-certificate">Secure Certificate</a></li>
<li><a class="reference internal" href="#command-examples">Command Examples</a><ul>
<li><a class="reference internal" href="#response-format">Response Format</a></li>
<li><a class="reference internal" href="#query-interface">Query interface</a></li>
</ul>
</li>
<li><a class="reference internal" href="#columns">Columns</a></li>
<li><a class="reference internal" href="#filters">Filters</a></li>
<li><a class="reference internal" href="#stats">Stats</a><ul>
<li><a class="reference internal" href="#command-interface">Command Interface</a></li>
</ul>
</li>
<li><a class="reference internal" href="#acknowledgements">Acknowledgements</a></li>
<li><a class="reference internal" href="#downtime">Downtime</a></li>
<li><a class="reference internal" href="#notifications">Notifications</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="nems_php_agent.html" title="previous chapter">NEMS PHP Server Agent</a></li>
      <li>Next: <a href="../accessories/index.html" title="next chapter">NEMS Accessories</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/advanced/nems-api.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Category5 TV Network.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../_sources/advanced/nems-api.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>